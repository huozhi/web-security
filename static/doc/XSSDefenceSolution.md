#XSS 漏洞修复方案

#### 整理自乌云

- 什么都没过滤的情况

    将 `<`, `>` 过滤掉即可，或者已经被XSS过滤器过滤掉

- 输出在`<script><script/>`之间的

    过滤 `</xxx>` 组合

- 输出在html里的

    特殊情况特殊处理，分别过滤 `\` 或者 `&`,

    碰到有某些修复的人用正则去判断， `&#xNNN..`, 而实际上 `&#x0NN; &#x00NN`, （后面自己慢慢试。。） 都是可以的。 或者是 `&#10进制`; 以及一些特殊的HTML实体，如 `&quot;`等，都要注意到，好麻烦， 最好的办法，还是 `&` 过滤为 `&amp;`

- 宽字节注入
    
    修复相关过滤机制，对gbxxx，gbk编码要注意

- DOM XSS
    
    过滤`\`, `"`, `<`, '>', 或者`innerHTML = encodeHTML([output])`

- iframe

    javascript:, vbscript:, data: 等都需要过滤

- path

    可在调用外部json数据时，对参数进行严格控制。
    也可对jsonp接口的callback参数进行更加严格的字符控制，一般的callback，只需要允许，字母，数字+下划线即可。

- 存储型 XSS

    数据库存储之前需要各种过滤